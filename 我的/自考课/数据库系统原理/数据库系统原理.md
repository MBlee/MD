## 数据库概述

#### 数据库概念

###### 数据

```shell
Data:数据是描述事物的符号记录，是指用物理符号记录下来的、可以鉴别的信息。
# 举例
数据有很多表现形式，可以是包括数字、字母、文字、特殊字符组成的文本数据，也可以是图形、图像、动画、影响、声音、语言等多媒体数据。
例如，日常生活和工作中使用的客户档案记录、商品销售记录等都是数据。
# 数据描述
为能在计算机中有效存储和处理客观事物，人们通常只抽取那些感兴趣的事物特征或属性来描述事物，由这些具体的特征值所构成的一组数据，构成一条记录。
# 数据语义
仅有数据记录往往不能完全表达其内容的含义，有些还需要经过解释才能明确其表达的含义。
数据的解释是对数据含义的说明，也成为数据的语义，即数据所蕴含的信息。
数据及其语义密不可分，没有语义的数据是没有意义和不完整的。
数据是信息存在的一种形式，只有通过解释或处理的数据才能成为有用的信息。
```

###### 数据库

```shell
DB:数据库通俗地被称为存储数据的仓库，只是这个仓库存储在计算机存储设备上的，并且其所存储的数据是按一定的格式进行存储的。
严格意义上来讲，数据库是指长期存储在计算机中的有组织的、可共享的数据集合，且数据库中的数据按一定的数据模型组织、描述和存储，具有较小的冗余度、较高的数据独立性，系统易扩展，可以被多个用户共享。
概括而言，数据库中存储的数据具有永久存储、有组织、和可共享三个基本特点。
```

###### 数据库管理系统

```shell
DBMS:数据库管理系统是专门用于建立和管理数据库的一套软件，介于应用程序和操作系统之间。
负责科学有效的组织和管理数据，并帮助数据库的使用者能够从大量的数据中快速地获取所需数据，以及提供必要的安全性和完整性等同意管理机制，实现对数据有效的管理和保护。
# 主要功能
与操作系统一样，也是计算机的基础软件，即一类系统软件，其主要功能包括如下几个方面。
1.数据定义功能
2.数据操纵功能
3.数据库的运行管理功能
4.数据库的建立和维护功能
5.数据组织、存储和管理功能
6.其他功能（主要包括与其他软件的网络通信功能、不同数据库管理系统之间的数据传输以及相互访问功能）
```

###### 数据库系统

```shell
DBS:是指计算机中移入数据库技术之后的系统。
通常一个完整的数据库系统包括数据库、数据库管理系统及相关实用工具、应用程序、数据库管理员和用户。
```

#### 数据库管理技术发展

#### 数据库系统结构

###### 三级模式结构

```shell
从数据库管理员（DBA）的视角看，可分为内部系统结构和外部体系结构，其中内部结构通常采用三级模式结构，而外部体系结构通常表现为集中式结构、分布式结构和并行结构等。
是指数据库系统是由模式(Schema)、外模式(External Schema)和内模式(Internal Schema)三级构成的。
# 模式
# 外模式
# 内模式
# 两层映像与数据独立性
```

###### 运行与应用结构

```shell
从数据库应用的用户（如应用程序的编写人员）视角看，目前通常具有客户/服务器结构和浏览器/服务器结构，这也是数据库系统整体的运行与应用结构。
# 客户/服务器结构
# 浏览器/服务器结构
```

#### 数据模型

###### 数据特征与数据模型组成要素

```shell
通常由数据结构、数据操作、数据约束三个要素组成。
# 数据结构
# 数据操作
# 数据约束
```

###### 数据模型分类

```shell
数据模型满足三个方面要求，即能真实地模拟现实世界，容易为人们所理解，同时，便于在计算机上实现。
是模型化数据和信息的工具，也是数据库系统的核心。
# 概念层数据模型
实体|属性|键码|实体型|实体集|联系
表示方法：ER图
# 逻辑层数据模型
层次模型|网状模型|关系模型
# 物理层数据模型
```

## 关系数据库 

#### 关系数据模型

#### 规范化理论

###### 关系模式潜在冗余和异常问题

```shell
# 数据冗余
# 更新异常
# 插入异常
# 删除异常
```

###### 函数依赖和关键字

```shell
# 完全函数依赖
设R，如果对于R中X的每一个值，R中Y只有唯一值与之对应，则称X函数决定Y或Y函数依赖于X，记X→Y，X为决定因素。
# 部分函数依赖
设R，X、Y为其属性集，X→Y，且X存在一个真子集X''→Y，则称Y部分函数依赖于X。
# 传递函数依赖
设R，X、Y、Z为其属性集，X→Y，Y→/X,Y→Z，则有X→Z，则称Z传递函数依赖于X。
# 关键字
设R，U为全部属性集，X为U子集，若有完全函数依赖X→U，则X为R的一个候选关键字。
```

###### 范式与规范化过程

```shell
# 第一范式
设R，如果R中每个列与行的交点处都是不可再分的基本元素，则R为第一范式。
# 第二范式
设R满足1NF，且R所有非主属性都完全依赖于候选关键字，则R为第二范式。
# 第三范式
设R满足2NF，且R每一个非主属性都不传递依赖于候选关键字，则R为第三范式。
# BCNF范式
设R满足3NF，F为函数依赖集，且F中所有函数依赖X→Y（Y不属于X）中的X必包含候选关键字，则为第三范式。
```

## 数据库设计

#### 数据库设计概述

```shell
# 设计过程
按照设计方法分为以下几个步骤：
需求分析；
结构设计：概念结构、逻辑结构、物理结构设计；
行为设计：功能设计、事务设计、程序设计；
实施阶段：加载数据库数据和运行应用程序；
运行和维护阶段。
```

#### 数据库基本步骤

###### 需求分析

```shell
# 确定数据库范围
首先考虑支持用户工作需要所必须的应用需求，其次考虑将来的应用需求，提高应变能力。
根据机构和职能关系图来确定数据库范围。（用户图）
# 应用过程分析
逐次了解和分析每一部门或功能要用到哪些数据、数据使用的顺序、对数据作何处理和处理的策略及处理的结果等。（流程图）
# 收集和分析数据
了解并分析数据的组成格式及操作特征。
静态结构：数据分类表，用于数据的总体描述。数据元素表，指数据项或属性。
动态结构：任务分类表，根据数据流程图分析，一个任务指为完成某一特定处理功能的相对独立的操作序列。数据操作特征表，不同任务对数据执行不同操作的频率。
数据约束：数据的安全保密性，针对各种不同类数据，不同授权。数据的完整性，数据正确性的约束范围和验证准则，以及一致性保护的要求。响应时间，主要指数据存取时间限制。数据恢复，转储及回复的时机与范围要求。
# 需求分析报告
1.数据库的应用功能目标
2.标明不同用户视图范围
3.应用处理过程需求说明：
数据流程图：主要反应部门原始业务处理的工作流程。
任务分类表：其标明不同任务的功能及使用状况。
数据操作特征表：标明任务和数据间的联系及不同数据的不同操作特征和频率。
操作过程说明书标明各任务的主要逻辑执行步骤。
4.数据字典
5.数据量
6.数据约束
```

###### 概念结构设计

```shell
根据分析报告，设计用户信息结构，称为概念模型。
# 常用方法
实体分析法：自顶向下法，E-R图
属性综合法：自底向上法，高层实体及联系通过底层属性组成。
```

###### 逻辑结构设计

```shell
将概念模型转换为等价的、并为特定DBMS所支持数据模型的结构，一般由层次、网状、关系数据模型表示。
1.一个特定DBMS支持的概念模式，或称之为模式。
2.一个或多个外部视图，或称之为子模式。
3.物理设计说明
4.程序设计说明
# 设计步骤
概念设计→模型转换→子模式设计
应用程序设计说明→设计评价→物理设计
```

###### 物理设计

```shell
对于给定的数据库逻辑结构，研究并构造物理结构的过程，确定存储结构及存取方法，还可能包括建立索引和聚集，以及物理块大小、缓冲区个数和大小、数据压缩的选择等。
```

###### 数据库实施

```shell
1.加载数据。将符合要求的初始数据装载到数据库中去，数据手机、分类、整理校验和输入。
2.应用程序设计。
3.数据库试运行。
```

###### 数据库运行和维护

```shell
数据库重组：当空间利用率和存取效率下降时进行的，不改变逻辑和物理结构，调整存储位置。
数据库重构：改变逻辑或物理结构，增删改数据类型、索引与聚集等。
```

#### 关系数据库设计

###### 概念结构设计

```shell
# E-R图
两实体联系：1:1 → 1:N → N:M
两个以上联系
一个实体内联系
# 局部信息结构设计
不同用户视图范围所建立的满足该范围内用户需求的信息结构，称为局部信息结构。
确定局部范围：部门和功能相对独立，同其他局部范围相互影响较少，并且实体个数适量。
选择实体：共性较大，合并为一个实体。
选择实体的关键字属性：唯一标识实体。
确定实体间联系：将局部实体和其他实体逐一匹配。
确定实体属性：说明属性的存在和使用通常依赖于标识属性。
# 全局信息结构设计
确保信息一致性、减少冗余数据量。
属性冲突：属性域冲突，属性取值单位冲突。
命名冲突：同名异义，异名同义。
结构冲突：同一对象在一个局部ER作为实体，在另一个作为属性；同一实体在不同ER中属性和类型不同；实体间联系在不同ER中是不同类型。
优化步骤：相关实体类型的合并、消除不必要的冗余属性、消除不必要的冗余联系。
```

###### 逻辑结构设计

```shell
在关系数据库中，是把概念结构设计的ER图转换为关系模型。
# 将ER图转换为关系模型
一个实体型转换为一个关系模式。
一对一联系可以转为为一个独立的关系模式，也可以与任意一端对应的关系模式合并。
一对多联系可以转换为一个独立的关系模式，也可以与N端对应的关系模式合并。
多对多联系可以转换为一个关系模式。关系的码为各实体码的组合。
三个或三个以上实体的多元联系可以转换为一个关系模式。关系的码为各实体码的组合。
具有相同码的关系模式可合并。
# 对关系数据模型进行优化
通常以关系规范化理论为指导；
确定各属性间的函数依赖关系。
对于各个关系模式之间的数据依赖进行极小化处理，消除冗余的联系。
判断每个关系模式的范式，根据实际需要确定最合适的范式。
按照需求分析阶段得到的处理要求，分析这些模式对于这样的应用环境是否合适，确定是否要对某些模式进行合并或分解。
对关系模式进行必要的分解，提高数据操作的效率和存储空间的利用率。
# 设计面向用户的外模式
根据局部应用需求，利用视图设计更符合局部用户需要的用户外模式。
设计用户视图时，重定义属性别名，使其更符合用户习惯。
可以对不同级别用户定义不同视图，以保证系统的安全性。
简化用户对系统的使用。将复杂查询定义为视图，大大简化用户的使用。
```

###### 物理结构设计

```shell
通过对关系建立索引和聚集来实现与应用相关数据的逻辑连接和物理聚集，改善对数据库的存取效率
# 建立索引
建立索引会带来索引空间的开销，因而建立索引的数据对象通常应具有较少的插入、修改和删除操作。
一般，用以建立索引的那些属性也应是其所在关系中使用频率较高的属性。
静态索引，应用人员预先建立索引，一旦建立，后续的应用程序可直接使用该索引存取数据。适用于用户较多和使用周期较长的数据；
动态索引，应用人员在程序内外临时建立索引，适用于单独用户或临时性使用要求情况。
# 建立聚集
将相关数据集中存放的物理存储技术，借以提高I/O的数据命中率而改善存取速度。
```

## 四___SQL与关系数据库基本操作 

## 六___数据库编程

```mysql 
存储过程和存储函数区别：
1. 存储函数不需要输出参数，因为存储函数本身就是输出参数；而存储过程可以有输出参数。
2. 存储函数可以直接调用，不需要使用Call；而存储过程需要使用CALL调用。
3. 存储函数必须有一条RETURN语句，而存储函数不能包含RETURN语句
游标：是SELECT语句检索出来的数据集，可以滚动或浏览查看。
# SQL语法
DECLARE cur CURSOR FOR SELECT ...
OPEN cur
FETCH cur INTO ...
CLOSE cur
DELIMITER $$
DETERMINISTIC
SET var=...
SELECT ... INTO ...
WHILE ... DO ... END WHILE
REPEAT LOOP
IF THEN ELSE IF THEN ELSE END IF
```

###### 存储过程

```mysql
存储过程就是一组SQL语句集，可由声明式SQL语句和过程式SQL语句组成，编译并存储在数据库内部。
CREATE PROCEDURE sp(IN|OUT|INOUT par type)
	BEGIN END
DROP PROCEDURE IF EXISTS sp
CALL sp(...)
# 优点
1. 可增强SQL语言的功能和灵活性
2. 良好的封装性
3. 高性能
4. 减少网络流量
5. 可作为一种安全机制以保证数据库的完整性和安全性
```

###### 存储函数

```mysql
存储函数就是一组SQL语句，可以被应用程序或其他SQL语句调用。
CREATE FUNCTION fn(par type) RETURNS type
	BEGIN RETURN END
DROP FUNCTION fn
SELECT fn(...)
```

## 七___数据库安全和保护

###### 数据完整性

```mysql
MySQL中，完整性约束作为数据库关系模式定义的一部分，由CreateTable或ElterTable定义。
完整性是指数据库中数据的正确性和相容性。
完整性约束是指数据库加在数据上的语义约束条件。
完整性检查指检查是否满足完整性约束条件的机制。
约束对象:列（数据类型、取值范围、精度）、元组（各字段）、表（元组、关系之间的联系）。
# 实体完整性
主键约束（列/表）：
1. 一表一个主键
2. 唯一性（唯一标志，不能为NULL）
3. 最小性（不包含多余列）
4. 列名在符合主键中只能出现一次
候选键约束：1.多个	2.Unique索引
# 参照完整性
FOREIGN KEY(col) tbl(col,...) 
	ON DELETE|UPDATE RESTRICT|CASCADE|SET NULL
- 参照表（自参照，主键，必须主键/候选键）
- 值（允许一个空值，列类型对应，列数目对应）
# 用户自定义完整性
- 非空约束（NOT NULL）
- CHECK约束（CHECK） 
```

```shell
# 触发器
是用户定义在关系表上的一类由事件驱动的数据库对象，也是一种保证数据完整性的方法。
主要作用是：实现主键和外键不能保证的复杂的参照完整性和数据的一致性，从而有效的保护表中的数据。
- 一表一事件一个触发器（6个）
- 单一触发器不能和多个事件或多个表关联
- 涉及自身更新，只能BeforeUpdate
```

###### 安全性和访问控制

```shell
数据库的安全性是保护数据库以防止不合法的使用而导致数据泄露、更改或破坏。
MySQL的安全保护机制是由身份认证、数据库用户权限认证实现的。
```

```mysql
# 用户管理
CREATE USER u IDENTIFIED BY PASSWORD '123'
DROP USER IF EXISTS u
RENAME USER old TO new
SET PASSWORD [FOR u] = { PASSWORD()|'HASH' }
```

```mysql
# 权限管理
SHOW GRANT FOR u
GRANT CREATE USER 
	ON *.*
	TO u [IDENTIFIED BY '123'] 
	WITH GRANT OPTION
REVOKE ALL PRIVILEGES ,GRANT OPTION FROM u
```

###### 事务与并发控制

```mysql
事务是用户定义的一个数据操作序列，可作为一个完整的工作单元，要么全部执行，要么全部不执行，是一个不可分割的工作单位。
MYSQL中可以是一条SQL语句、一组SQL语句或整个程序。
COMMIT: 全部提交 ROLLBACK: 全部撤回
# 特征（ACID）
1.原子性
2.一致性
3.隔离性（可串行性）
4.持续性
```

```shell
并发控制机制是指以正确的方式调度并发操作，使一个事务的操作不受另一个事务的干扰，从而避免数据的不一致性。
# 并发操作问题
- 丢失更新
- 不可重复读
- 读脏数据
# 并发-封锁（X/S）
工作原理：
1.事务执行数据库操作必须请求对应的锁；
2.事务一直占有获得的锁知道结束时释放。
粒度：封锁的数据单元的大小。
级别：0123
# 活锁与死锁
活锁：在并发事务中，锁会使一个事务处于等待状态而调度其他事务，该事务可能因优先级低而永远等待下去。
死锁：两个以上事务循环等待被另一事务中锁住的数据单元的情形，被称为死锁。
死锁预防：
1.一次性锁请求
2.锁请求排序
3.序列化处理
4.资源剥夺
死锁检测：可以用图论的方法是实现，并以正在执行的事务为节点。
# 两段封锁法（可串行）
- 发展或加锁阶段
- 收缩或释放锁阶段
遵循两段封锁协议的事务的任何并发调度都是可串行化的。
```

###### 备份与恢复

```mysql
在数据丢失或被破坏的情况下，保证数据库的可靠性和完整性；
通过备份和恢复，数据库可以从一个服务器移动或复制到另一个服务器上。
备份：通过导出数据或复制表文件的方式制作数据库的副本。
恢复：当数据库发生故障或遭到破坏时，将备份的数据库加载到系统，从而使数据库从错误状态恢复到备份时的正确状态。
SELECT ... INTO OUTFILE 'C:///'
	FIELDS TERMINATED BY ','
		OPTIONALLY ENCLOSED BY '"',
		ESCAPED BY '*'
	LINES TERMINATED BY '?'
LOAD DATA INFILE 'C:///' INTO TABLE 
	FIELDS ...
	LINES STARTING BY 'SS'
# 锁定
LOCK TABLES _tbl READ|WRITE
UNLOCK TABLES _tbl
```

## 八___数据管理技术的发展

#### 数据库发展概述

###### 第一代数据库系统

```shell
层次数据库系统和网状数据库系统的数据模型分别为层次模型、网状模型，属于第一代。
# 特点
1. 支持三级模式的体系结构，模型之间有转换功能；
2. 使用存储路径表示数据间的联系；
3. 独立的数据定义语言；
4. 导航的数据操纵语言。
```

###### 第二代数据库系统

```shell
以关系数据模型为数据模型的关系数据库为第二代。
关系模型包括数据结构、关系操作和数据完整性。
以关系代数为语言模型，以关系数据理论为理论基础。
# 特点
模型简单清晰、理论基础好、数据独立性强、数据库语言非过程化和标准化等特点。
```

###### 第三代数据库系统

#### 数据仓库和数据挖掘

```shell
# 联机事务处理：OLTP（操作型）
# 联机分析处理：OLAP（分析型）
```

###### 数据仓库

```shell
数据仓库是面向主题的、集成的、稳定的、随时间变化的数据集合，用以支持管理决策的过程。
数据集市：基本思想是自下而上的数据仓库开发方法。一般可以将数据集市分为独立的数据集市和从属的独立集市或两种数据集市的混合。
# 特征
1. 面向主题
2. 集成性
3. 数据的非易失性
4. 数据的时变性
# 三个概念
1. 粒度：是指数据仓库的数据单位中保存数据的细化或综合程度的级别。成反比。
2. 分割：是将数据分散到各自的物理单元中，以便能分别处理，以提高数据处理的效率。数据分割后的单元称为切片。
3. 维：是人们观察问题的特定角度，是考虑问题时的一类属性。（维层次）
```

###### 数据挖掘

```shell
数据挖掘是从大量的、不完全的、模糊的、有噪声的、随机的实际应用数据中发现并提取隐藏在其中的、事先不知道的、但又是潜在有用的信息和知识的一种技术。(数理统计、模 糊数学、机器学习、模式识别)
# 功能
1. 概念描述
2. 关联分析（简单关联、时序关联、因果关联）
3. 分类与预测（决策树模型、神经网络模型、线性回归模型）
4. 聚类
5. 孤立点检测
6. 趋势和演变分析
# 步骤
1. 确定业务对象
2. 数据的选择
3. 数据的预处理
4. 建模
5. 模型评估
6. 模型部署
```

#### 大数据

```shell
# 概述
指无法在容忍的时间内使用现有信息技术、软硬件对其进行感知、获取、管理、处理的服务的数据的集合。
# 特征
1. 大量化
2. 多样化
3. 快速化
4. 价值密度低
```

###### 技术

```shell
# 大数据存储（分布式文件系统）
HDFS分布式文件系统统一管理多个服务器节点上存储的数据（Hadoop架构）。
# NoSQL（分布式数据库系统）
非关系数据库，数据管理技术不仅仅是SQL
1. 键值（Key-Value）模型；（简单查询）
2. 文档（Document）模型；（复杂查询）（CouchDB）
3. 列（Column）模型；（Cassandra/HBase）
4. 图（Graph）模型。（节点/属性/边）
# MapReducer
是一种简单易用的软件框架。基于它可以开发出运行在成千上万个节点上，并以容错的方式并行处理海量数据的算法和软件。
```


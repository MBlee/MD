## 一___数据库概述

#### 数据库概念

###### 数据库

```shell
# 数据库特点
- 永久存储
- 有组织
- 可共享
```

###### 数据库管理系统

```shell
DBMS:数据库管理系统是专门用于建立和管理数据库的一套软件，介于应用程序和操作系统之间。
# 主要功能
与操作系统一样，也是计算机的基础软件，即一类系统软件，其主要功能包括如下几个方面。
1.数据定义功能
2.数据操纵功能
3.数据库的运行管理功能
4.数据库的建立和维护功能
5.数据组织、存储和管理功能
6.其他功能（主要包括与其他软件的网络通信功能、不同数据库管理系统之间的数据传输以及相互访问功能）
```

###### 数据库系统

```shell
DBS:是指计算机中移入数据库技术之后的系统。
通常一个完整的数据库系统包括数据库、数据库管理系统及相关实用工具、应用程序、数据库管理员和用户。
```

#### 数据库管理技术发展

```shell
人工管理阶段、文件系统阶段、数据库系统阶段
# 特点
1. 数据集成
2. 共享性高
3. 数据冗余小
4. 数据一致性
5. 数据独立性高
6. 实施统一管理和控制。（完整性、安全性、并发控制、故障恢复）
7. 减少应用程序开发和维护的工作量
```

#### 数据库系统结构

```shell
从数据库管理员（DBA）的视角看，可分为内部系统结构和外部体系结构，其中内部结构通常采用三级模式结构，而外部体系结构通常表现为集中式结构、分布式结构和并行结构等。
从数据库应用的用户（如应用程序的编写人员）视角看，目前通常具有客户/服务器结构和浏览器/服务器结构，这也是数据库系统整体的运行与应用结构。
```

###### 三级模式结构

```shell
是指数据库系统是由模式(Schema)、外模式(External Schema)和内模式(Internal Schema)三级构成的。
# 模式
# 外模式
# 内模式
# 两层映像与数据独立性
```

###### 运行与应用结构

```shell
# 客户/服务器结构
# 浏览器/服务器结构
```

#### 数据模型

###### 数据特征与数据模型组成要素

```shell
通常由数据结构、数据操作、数据约束三个要素组成。
```

###### 数据模型分类

```shell
数据模型满足三个方面要求，即能真实地模拟现实世界，容易为人们所理解，同时，便于在计算机上实现。
是模型化数据和信息的工具，也是数据库系统的核心。
# 概念层数据模型
实体|属性|键码|实体型|实体集|联系
表示方法：ER图
# 逻辑层数据模型
层次模型|网状模型|关系模型
# 物理层数据模型
```

## 二___关系数据库 

#### 关系数据模型

#### 规范化理论

###### 关系模式潜在冗余和异常问题

```shell
1. 数据冗余
2. 更新异常
3. 插入异常
4. 删除异常
```

###### 函数依赖和关键字

```shell
# 完全函数依赖
设R，如果对于R中X的每一个值，R中Y只有唯一值与之对应，则称X函数决定Y或Y函数依赖于X，记X→Y，X为决定因素。
# 部分函数依赖
设R，X、Y为其属性集，X→Y，且X存在一个真子集X''→Y，则称Y部分函数依赖于X。
# 传递函数依赖
设R，X、Y、Z为其属性集，X→Y，Y→/X,Y→Z，则有X→Z，则称Z传递函数依赖于X。
# 关键字
设R，U为全部属性集，X为U子集，若有完全函数依赖X→U，则X为R的一个候选关键字。
```

###### 范式与规范化过程

```shell
# 第一范式
设R，如果R中每个列与行的交点处都是不可再分的基本元素，则R为第一范式。
# 第二范式
设R满足1NF，且R所有非主属性都完全依赖于候选关键字，则R为第二范式。
# 第三范式
设R满足2NF，且R每一个非主属性都不传递依赖于候选关键字，则R为第三范式。
# BCNF范式
设R满足3NF，F为函数依赖集，且F中所有函数依赖X→Y（Y不属于X）中的X必包含候选关键字，则为第三范式。
```

## 三___数据库设计

#### 数据库设计概述

```shell
数据库分析与设计、数据库实施与操作
# 数据库设计方法
1. 直观设计
2. 规范设计
3. 计算辅助设计
```

#### 数据库基本步骤

###### 需求分析

```shell
# 确定数据库范围
# 应用过程分析（数据流程图）
# 收集和分析数据（响应时间）
# 需求分析报告
1.数据库的应用功能目标
2.标明不同用户视图范围
3.应用处理过程需求说明
```

###### 概念结构设计

```shell
根据分析报告，设计用户信息结构，称为概念模型。
# 常用方法
实体分析法：自顶向下法，E-R图
属性综合法：自底向上法，高层实体及联系通过底层属性组成。
```

###### 逻辑结构设计

```shell
将概念模型转换为等价的、并为特定DBMS所支持数据模型的结构，一般由层次、网状、关系数据模型表示。
# 设计步骤
模型转换→子模式设计
应用程序设计说明→设计评价
```

###### 物理设计

```shell
对于给定的数据库逻辑结构，研究并构造物理结构的过程，确定存储结构及存取方法，还可能包括建立索引和聚集，以及物理块大小、缓冲区个数和大小、数据压缩的选择等。
```

###### 数据库实施

```shell
1.加载数据。
2.应用程序设计。
3.数据库试运行。
```

###### 数据库运行和维护

```shell
数据库重组：当空间利用率和存取效率下降时进行的，不改变逻辑和物理结构，调整存储位置。
数据库重构：改变逻辑或物理结构，增删改数据类型、索引与聚集等。
```

#### 关系数据库设计

###### 概念结构设计

```shell
# E-R图
两实体联系：1:1 → 1:N → N:M
两个以上联系
一个实体内联系
# 局部信息结构设计（实体、关键字、属性、联系）
# 全局信息结构设计（属性冲突、命名冲突、结构冲突）
```

###### 逻辑结构设计

```shell
在关系数据库中，是把概念结构设计的ER图转换为关系模型。
# 将ER图转换为关系模型
1. 一个实体型转换为一个关系模式。
2. 一对一联系可以转为为一个独立的关系模式，也可以与任意一端对应的关系模式合并。
3. 一对多联系可以转换为一个独立的关系模式，也可以与N端对应的关系模式合并。
4. 多对多联系可以转换为一个关系模式。关系的码为各实体码的组合。
5. 三个或三个以上实体的多元联系可以转换为一个关系模式。关系的码为各实体码的组合。
6. 具有相同码的关系模式可合并。
# 对关系数据模型进行优化
通常以关系规范化理论为指导；
1. 确定各属性间的函数依赖关系。
2. 对于各个关系模式之间的数据依赖进行极小化处理，消除冗余的联系。
3. 判断每个关系模式的范式，根据实际需要确定最合适的范式。
4. 按照需求分析阶段得到的处理要求，分析这些模式对于这样的应用环境是否合适，确定是否要对某些模式进行合并或分解。
5. 对关系模式进行必要的分解，提高数据操作的效率和存储空间的利用率。
# 设计面向用户的外模式
根据局部应用需求，利用视图设计更符合局部用户需要的用户外模式。
1. 设计用户视图时，重定义属性别名，使其更符合用户习惯。
2. 可以对不同级别用户定义不同视图，以保证系统的安全性。
3. 简化用户对系统的使用。将复杂查询定义为视图，大大简化用户的使用。
```

###### 物理结构设计

```shell
通过对关系建立索引和聚集来实现与应用相关数据的逻辑连接和物理聚集，改善对数据库的存取效率
# 建立索引
静态索引，应用人员预先建立索引
动态索引，应用人员在程序内外临时建立索引
# 建立聚集
将相关数据集中存放的物理存储技术，借以提高I/O的数据命中率而改善存取速度。
```

## 四___SQL与关系数据库基本操作 

#### SQL概述

```shell
SQL是关系数据库的标准语言，是一种数据库查询和程序设计语言，用于存取数据和查询、更新和管理关系数据库系统。
包括：数据定义语言、数据查询语言、数据操纵语言、数据控制语言。
1. 数据定义语言；（主要对数据库和数据库中各种对象进行创建、删除、和修改）
2. 数据操纵语言；（对表或视图操作）
3. 数据控制语言；（安全控制，语言许可或对象许可权限）
4. 嵌入式和动态SQL规则；
5. SQL调用和会话规则。
# 特点
- SQL不是某个特定数据库供应商专用的语言；
- SQL简单易学；
- SQL是一种强有力的语言，灵活使用其语言元素，可以进行非常复杂和高级的数据库操作；
- SQL不区分大小写
```

#### MySQL概述

```shell
MySQL是一种关系数据库管理系统，具有客户/服务器体系结构。
遵循SQL标准，提供了对数据库...语言的支持，支持三级模式。
# 特点
- 体积小
- 速度快
- 开放源代码
- 遵循GPL（GNU通用公共许可证）
# 扩展要素
- 常量（NULL）
- 变量（@@）
- 运算符|表达式|内置函数
```

#### 数据定义

```mysql
## 数据库模式
包括数据库模式的创建、选择、修改、删除、查询。
CREATE|ALTER { SCHEMA|DATABASE } db
	DEFAULT CHARACTER SET gb2312
	DEFAULT COLLATE gb2312_chinese_ci
DROP DATABASE IF EXISTS db
SHOW DATABASES LIKE '%' WHERE ...
```

```mysql
## 数据表
被定义为字段的集合，数据在表中是按照行和列的格式存储的。每一行代表一条记录，每一列代表字段的取值。创建表的过程，就是定义每个字段的过程，也是实施数据完整性约束的过程。
CREATE [TEMPORARY] TABLE tbl(
	id INT NOT NULL AUTOINCREMENT,
  	sex CHAR(1) DEFAULT 0,
  	PRIMARY KEY(id),
  	CONSTRAINT [symbol] UNIQUE KEY(id)
  	FOREIGN KEY(id)
)
ALTER TABLE tbl
	RENAME TO tbl1
	ADD COLUMN ...
	DROP COLUMN ...
	CHANGE COLUMN ... FIRST|AFTER
	MODIFY COLUMN ... FIRST|AFTER
	ALTER COLUMN ... SET|DROP DEFAULT
RENAME TABLE ... TO ...
DROP TABLE IF EXISTS tbl
SHOW TABLES {FROM|IN} db
SHOW COLUMNS {FROM|IN} tbl
SHOW CREATE TABLE tbl
DESC tbl
```

```mysql
## 索引
就是按照一定顺序从一个表中一个列或若干列和表中的记录建立的一一对应的关系表，实质上就是一个列值和原表中记录一一对应的有序表。可以提升数据文件查询速度。
- 普通索引|主键索引|唯一性索引
# 缺点
- 以文件存储
- 更新操作慢
CREATE INDEX idx 
	ON tbl(col DESC...)
DROP INDEX IF EXISTS idx
	ON tbl
SHOW INDEXES {FROM|IN} tbl
```

```mysql
## 视图
是一个数据库的对象，是数据库管理系统提供给用户的以多角度观察数据中数据的重要机制，就是根据一个或多个表或若干视图的查询结果组成的表，包含有名字的列和若干条记录，也有自己的视图名。
# 区别
- 不是一张真实的表，是一张虚拟表，其结构和数据是建立在数据库真实表的查询基础上的。
# 优点
- 集中分散数据
CREATE|ALTER VIEW v(col) 
	AS SELECT ...
	WITH CHECK OPTION
DROP VIEW IF EXISTS v
SHOW CREATE VIEW v
```

#### 数据操纵

```mysql
INSERT INTO tbl(col)
	VALUES(...)
	SET col=val
	SELECT...
UPDATE tbl
	SET col=val
	WHERE...
	ORDER BY LIMIT
DELETE FROM tbl
	WHERE...
	ORDER BY LIMIT
```

#### 数据查询

```mysql
其数学理论基础是关系数据模型中对表对象的一组关系运算，即选择、投影、连接。
SELECT语句的功能是从数据库中快捷方便地检索、统计或输出数据。
执行过程是从数据库中选取匹配的特定的行和列，并将这些数据组织成一个结果集，然后以一张临时表的形式返回。
SELECT DISTINCT col,col AS col1,co1+1,COUNT(*)
# 多表连接查询
- 笛卡尔积（交叉连接）CROSS JOIN ,
	一张表的每一行和另一张表的每一行的笛卡尔乘积，返回每一行相乘的所有乘积。
- 内连接 JOIN
	通过在查询中设置连接条件的方式，来移除查询结果中某些数据行之后的交叉连接。
- 外连接 LEFT JOIN
	以基表为依据返回满足和不满足条件的记录。
# WHERE查询
- 子查询(表、行、列、标量)
	ALL | ANY | SOME | IN | EXISTS
# GROUP BY
将结果集中的数据行根据选择列的值进行分组，以便能汇总表内容的子集，即实现对每个组的聚集计算。
- 可以多列（逆序汇总，最后分组进行完全汇总）
- SELECT的列名必须在 GROUP BY 中指定
- NULL值单独一个组
# HAVING BY
- 过滤分组
- 可使用聚合函数
- 在分组后
# ORDER BY
- 可以包含子查询
- 多列
- NULL值
```

## 五___数据库编程

```mysql 
存储过程和存储函数区别：
1. 存储函数不需要输出参数，因为存储函数本身就是输出参数；而存储过程可以有输出参数。
2. 存储函数可以直接调用，不需要使用Call；而存储过程需要使用CALL调用。
3. 存储函数必须有一条RETURN语句，而存储函数不能包含RETURN语句
游标：是SELECT语句检索出来的数据集，可以滚动或浏览查看。
# SQL语法
DECLARE cur CURSOR FOR SELECT ...
OPEN cur
FETCH cur INTO ...
CLOSE cur
DELIMITER $$
DETERMINISTIC
SET var=...
SELECT ... INTO ...
WHILE ... DO ... END WHILE
REPEAT LOOP
IF THEN ELSE IF THEN ELSE END IF
```

###### 存储过程

```mysql
存储过程就是一组SQL语句集，可由声明式SQL语句和过程式SQL语句组成，编译并存储在数据库内部。
CREATE PROCEDURE sp(IN|OUT|INOUT par type)
	BEGIN END
DROP PROCEDURE IF EXISTS sp
CALL sp(...)
# 优点
1. 可增强SQL语言的功能和灵活性
2. 良好的封装性
3. 高性能
4. 减少网络流量
5. 可作为一种安全机制以保证数据库的完整性和安全性
```

###### 存储函数

```mysql
存储函数就是一组SQL语句，可以被应用程序或其他SQL语句调用。
CREATE FUNCTION fn(par type) RETURNS type
	BEGIN RETURN END
DROP FUNCTION fn
SELECT fn(...)
```

## 六___数据库安全和保护

###### 数据完整性

```mysql
MySQL中，完整性约束作为数据库关系模式定义的一部分，由CreateTable或ElterTable定义。
完整性是指数据库中数据的正确性和相容性。
完整性约束是指数据库加在数据上的语义约束条件。
完整性检查指检查是否满足完整性约束条件的机制。
约束对象:列（数据类型、取值范围、精度）、元组（各字段）、表（元组、关系之间的联系）。
# 实体完整性
主键约束（列/表）：
1. 一表一个主键
2. 唯一性（唯一标志，不能为NULL）
3. 最小性（不包含多余列）
4. 列名在符合主键中只能出现一次
候选键约束：1.多个	2.Unique索引
# 参照完整性
FOREIGN KEY(col) tbl(col,...) 
	ON DELETE|UPDATE RESTRICT|CASCADE|SET NULL
- 参照表（自参照，主键，必须主键/候选键）
- 值（允许一个空值，列类型对应，列数目对应）
# 用户自定义完整性
- 非空约束（NOT NULL）
- CHECK约束（CHECK） 
```

```shell
# 触发器
是用户定义在关系表上的一类由事件驱动的数据库对象，也是一种保证数据完整性的方法。
主要作用是：实现主键和外键不能保证的复杂的参照完整性和数据的一致性，从而有效的保护表中的数据。
- 一表一事件一个触发器（6个）
- 单一触发器不能和多个事件或多个表关联
- 涉及自身更新，只能BeforeUpdate
```

###### 安全性和访问控制

```shell
数据库的安全性是保护数据库以防止不合法的使用而导致数据泄露、更改或破坏。
MySQL的安全保护机制是由身份认证、数据库用户权限认证实现的。
```

```mysql
# 用户管理
CREATE USER u IDENTIFIED BY PASSWORD '123'
DROP USER IF EXISTS u
RENAME USER old TO new
SET PASSWORD [FOR u] = { PASSWORD()|'HASH' }
```

```mysql
# 权限管理
SHOW GRANT FOR u
GRANT CREATE USER 
	ON *.*
	TO u [IDENTIFIED BY '123'] 
	WITH GRANT OPTION
REVOKE ALL PRIVILEGES ,GRANT OPTION FROM u
```

###### 事务与并发控制

```mysql
事务是用户定义的一个数据操作序列，可作为一个完整的工作单元，要么全部执行，要么全部不执行，是一个不可分割的工作单位。
MYSQL中可以是一条SQL语句、一组SQL语句或整个程序。
COMMIT: 全部提交 ROLLBACK: 全部撤回
# 特征（ACID）
1.原子性
2.一致性
3.隔离性（可串行性）
4.持续性
```

```shell
并发控制机制是指以正确的方式调度并发操作，使一个事务的操作不受另一个事务的干扰，从而避免数据的不一致性。
# 并发操作问题
- 丢失更新
- 不可重复读
- 读脏数据
# 并发-封锁（X/S）
工作原理：
1.事务执行数据库操作必须请求对应的锁；
2.事务一直占有获得的锁知道结束时释放。
粒度：封锁的数据单元的大小。
级别：0123
# 活锁与死锁
活锁：在并发事务中，锁会使一个事务处于等待状态而调度其他事务，该事务可能因优先级低而永远等待下去。
死锁：两个以上事务循环等待被另一事务中锁住的数据单元的情形，被称为死锁。
死锁预防：
1.一次性锁请求
2.锁请求排序
3.序列化处理
4.资源剥夺
死锁检测：可以用图论的方法是实现，并以正在执行的事务为节点。
# 两段封锁法（可串行）
- 发展或加锁阶段
- 收缩或释放锁阶段
遵循两段封锁协议的事务的任何并发调度都是可串行化的。
```

###### 备份与恢复

```mysql
在数据丢失或被破坏的情况下，保证数据库的可靠性和完整性；
通过备份和恢复，数据库可以从一个服务器移动或复制到另一个服务器上。
备份：通过导出数据或复制表文件的方式制作数据库的副本。
恢复：当数据库发生故障或遭到破坏时，将备份的数据库加载到系统，从而使数据库从错误状态恢复到备份时的正确状态。
SELECT ... INTO OUTFILE 'C:///'
	FIELDS TERMINATED BY ','
		OPTIONALLY ENCLOSED BY '"',
		ESCAPED BY '*'
	LINES TERMINATED BY '?'
LOAD DATA INFILE 'C:///' INTO TABLE 
	FIELDS ...
	LINES STARTING BY 'SS'
# 锁定
LOCK TABLES _tbl READ|WRITE
UNLOCK TABLES _tbl
```

## 八___数据管理技术的发展

#### 数据库发展概述

###### 第一代数据库系统

```shell
层次数据库系统和网状数据库系统的数据模型分别为层次模型、网状模型，属于第一代。（IMS）
# 特点
1. 支持三级模式的体系结构，模型之间有转换功能；
2. 使用存储路径表示数据间的联系；
3. 独立的数据定义语言；
4. 导航的数据操纵语言。
```

###### 第二代数据库系统

```shell
以关系数据模型为数据模型的关系数据库为第二代。
关系模型包括数据结构、关系操作和数据完整性。
以关系代数为语言模型，以关系数据理论为理论基础。
# 特点
模型简单清晰、理论基础好、数据独立性强、数据库语言非过程化和标准化等特点。
```

###### 第三代数据库系统

```shell
第三代数据库系统应该是以支持面向对象数据模型为主要特征的数据库系统。
# 特征
1. 应支持数据管理、对象管理和知识管理。
2. 必须保持或继承第二代数据库系统的技术。
3. 必须对其他系统保持开放。
# 开放性
1. 支持数据库语言标准；
2. 在网络上支持标准网络协议；
3. 系统具有良好的可移植性、可连接性、可扩展性和互操作性等。
```

#### 数据仓库和数据挖掘

```shell
# 联机事务处理：OLTP（操作型）
# 联机分析处理：OLAP（分析型）
```

###### 数据仓库

```shell
数据仓库是面向主题的、集成的、稳定的、随时间变化的数据集合，用以支持管理决策的过程。
数据集市：基本思想是自下而上的数据仓库开发方法。一般可以将数据集市分为独立的数据集市和从属的独立集市或两种数据集市的混合。
# 特征
1. 面向主题
2. 集成性
3. 数据的非易失性
4. 数据的时变性
# 三个概念
1. 粒度：是指数据仓库的数据单位中保存数据的细化或综合程度的级别。成反比。
2. 分割：是将数据分散到各自的物理单元中，以便能分别处理，以提高数据处理的效率。数据分割后的单元称为切片。
3. 维：是人们观察问题的特定角度，是考虑问题时的一类属性。（维层次）
```

###### 数据挖掘

```shell
数据挖掘是从大量的、不完全的、模糊的、有噪声的、随机的实际应用数据中发现并提取隐藏在其中的、事先不知道的、但又是潜在有用的信息和知识的一种技术。(数理统计、模 糊数学、机器学习、模式识别)
# 功能
1. 概念描述
2. 关联分析（简单关联、时序关联、因果关联）
3. 分类与预测（决策树模型、神经网络模型、线性回归模型）
4. 聚类
5. 孤立点检测
6. 趋势和演变分析
# 步骤
1. 确定业务对象
2. 数据的选择
3. 数据的预处理
4. 建模
5. 模型评估
6. 模型部署
```

#### 大数据

```shell
# 概述
指无法在容忍的时间内使用现有信息技术、软硬件对其进行感知、获取、管理、处理的服务的数据的集合。
# 特征
1. 大量化
2. 多样化
3. 快速化
4. 价值密度低
```

###### 技术

```shell
# 大数据存储（分布式文件系统）
HDFS分布式文件系统统一管理多个服务器节点上存储的数据（Hadoop架构）。
# NoSQL（分布式数据库系统）
非关系数据库，数据管理技术不仅仅是SQL
1. 键值（Key-Value）模型；（简单查询）
2. 文档（Document）模型；（复杂查询）（CouchDB）
3. 列（Column）模型；（Cassandra/HBase）
4. 图（Graph）模型。（节点/属性/边）
# MapReducer
是一种简单易用的软件框架。基于它可以开发出运行在成千上万个节点上，并以容错的方式并行处理海量数据的算法和软件。
```


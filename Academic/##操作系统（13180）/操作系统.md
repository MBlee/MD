## 一、操作系统概论

#### 计算机系统

```shell
#1.定义
计算机系统是一种可以按用户的要求接收和存储信息、自动进行数据处理并输出结果信息的系统。
#2.分类:
>广义:机械式系统和电子式系统
>电子式系统:模拟式和数字式计算机系统
#3.组成
>硬件(子)系统和软件(子)系统
```

```shell
#软件系统(程序、数据)
应用软件:文字处理、图形图像处理、科学计算、MIS...
支撑软件:数据库、网络、多媒体...
系统软件:操作系统、编译程序...
#硬件系统
中央处理器(CPU)、内存储器
外存储器(磁盘、磁带)输入输出设备(键盘、鼠标、显示器、打印机...)
```

```shell
# 计算机系统的资源:硬件资源、软件资源
在计算机系统中，集中了资源管理功能和控制程序执行功能的一种软件，称为操作系统。
```

#### 操作系统

```shell
# 定义
操作系统是计算机系统中的一个系统软件，它是这样一些程序模块的集合:它们能有效地组织和管理计算机系统中的硬件及软件资源，合理地组织计算机工作流程，控制程序的执行，并向用户提供各种服务功能，使得用户能够灵活、方便、有效地使用计算机，并使整个计算机系统能高效地运行。
# 定义解析:
1.组织和管理计算机系统中的硬件资源和软件资源。在操作系统中，设计了各种表格或数据结构，将所有的软硬件资源都加以登记。
比如:PCB、系统设备表等。
2."有效”
指操作系统在管理计算机资源时要考虑到系统运行的效率和利源的利用率。要尽可能提高中央处理器的利用率，让它尽可能少的空转，应该在保证访问效能的前提下尽可能有效地利用其它资源。比如:减少内存、硬盘空间的浪费等
3."合理”
指操作系统要“公平”对待不同的用户程序，保证系统不发生“死锁”和“饥饿”的现象。
4."方便”
指操作系统的人机界面要考虑到用户使用界面和程序接口两个方面的易用性、易学性和易维护性。用户使用接口:命令、图形界面，如Window图形
界面。
程序接口:程序员能够使用操作系统提供的服务供程编程。如Window提供的API接口，Linux的系统调用。
```

#### 操作系统特征

```shell
# 特征
1.并发性:
是指在计算机系统中同时存在着若干个运行着的程序，从宏观上看，这些程序在同时向前推进。
2.共享性:
操作系统需与多个用户程序共用系统中的各种资源，比如CPU、内存、外部设备等。
3.随机性
操作系统不能对所运行的程序的行为以及硬件设备的情况作出任何事先的假定。
即操作系统不能预知程序在什么时候运行，什么时候因为什么原因暂停，什么时候能得到资源继续运行，什么时候运行结束等，这些都是不可预知的。
```

#### 研究操作系统的观点

```shell
软件的观点
资源管理的观点
进程的观点
虚拟机的观点
服务提供的观点
```

```shell
1.软件的观点:
操作系统是一种大型系统软件，它是多种功能程序的集合。有外在特性和内在特性。外在特性:接口
内在特性:与硬件交互
2.资源管理的观点
操作系统负责登记谁在使用什么样的资源，系统中还有哪些资源空闲，当前响应了谁对资源的请求，以及回收那些不再使用的资源等。
3.进程的观点
把操作系统看做由多个可以同时独立运行的程序和一个对这些程序进行协调的核心。
侧重于分析系统各部分的并行工作，研究处理各项管理任务的分割以及这些管理任务相互之间的关系，比如:竞争资源、进程通信等。
4.虚机器的观点
在操作系统的支持下，用户不需要直接使用硬件机器(裸机)，而是通过操作系统提供的各种手段来控制和使用计算机。
例如，把所有对设备和文件的操作抽象为统一的打开、关闭、读、写等，用户感觉不到底层的操作差异。把操作系统的全部功能，包括系统调用、命令、作业控制语言等，称为操作系统虚机器。
5.服务提供者观点
从用户的角度，站在操作系统之外观察操作系统，认为该服务提供者为用户提供了比裸机功能更强、服务质量更高、更方便灵活的虚拟机。

```

#### 操作系统的功能

```shell
进程管理
存储管理
文件管理
设备管理
用户接口
```

```shell
1.进程管理
进程管理的实质:对中央处理器进行管理。或者称为处理机管理。
多道程序技术:多个程序同时放入内存，如果一个程序因为等待某个条件而不能运行，就把处理器专用权转交给另一个可运行程序。
进程的引入:为了描述多道程序的并发而引入
进程的简单定义:一个程序的运行过程
进程管理的内容:进程控制、进程同步、进程间通
信、调度。
2.存储管理
(1)任务:管理计算机内存的资源
(2)功能:
1内存的分配与回收:当多个程序共享有限的内存资源时，要考虑如何为多个程序分配有限的内存空间，以及程序运行完毕还需要内存回收。
2存储保护:存储在内存中的多个程序和数据应该彼此隔离、互不侵扰。
3内存扩充:将辅助存储器作为内存的扩充空间。
3.文件管理
(1)任务:
有效地支持文件的存储、检索和修改等操作，解决文件的共享、保密和保护问题，以便用户方便、安全地访问文件。
(2)功能:
1文件存储空间的管理
2目录管理
3文件系统的安全性
4.设备管理
(1)设备管理的含义:
指计算机系统中除了处理器和内存以外的所有输入、输出设备的管理。
(2)功能:
负责外部设备的分配、启动和故障处理。
(3)采用的技术
中断技术、通道技术、虚拟设备技术、缓冲技术，尽可能发挥设备和主机的并行能力。
5.用户接口
从用户观点看，操作系统是用户与计算机之间的接口。任务:为用户提供一个使用系统的良好环境，使用户能有效地组织自己的工作流程，并使整个系统高效地运行。
```

#### 操作系统的体系结构

#### Windows操作系统的体系结构

```shell
1.内核
功能:线程调度、陷入处理和异常调度、中断处理和调度、多处理器同步、供执行体使用的基本内核对象。
2.硬件抽象层HAL
系统可移植性的关键部分，为运行在Windows操作系统上的硬件平台低级接口，隐藏了各种与硬件有关的细节，如I/O接口等专用的和依赖于计算机平台的函数。
3.执行体
属于内核，以系统函数的形式提供了系统的服务，可通过Win32API进行访问
4.系统进程和系统线程
执行系统代码
```

#### UNIX操作系统的体系结构

```shell
1.内核层
是操作系统管理和控制中心，常驻内存。有两种接口:内核与硬件的接口和内核与shell的接口。内核本身分为两部分:进程控制子系统和文件子
系统。
2.系统层
内核层与应用层之间，供程序员开发调用，包括进程管理、文件管理、中断状态。
3.应用层
面向用户操作的界面

UNIX命令和库
系统调用接口
内核
硬件
用户应用程序
```

#### Linux操作系统的体系结构

```shell
四个部分:
系统和应用程序
内核、shell、文件

从低到高:应用程序层、应用框架层、系统运行库层和Linux内核层。
```

#### 操作系统的发展

```shell
1.手工阶段
2.监控程序
3.多道批处理
4.分时与实时操作系统
5.UNIX通用操作系统
6.个人计算机操作系统
7.Android操作系统
```

#### 操作系统的分类

```shell
# 根据用户界面和功能特征分类
三种基本类型:
1.批处理系统
2.分时系统
3.实时系统
# 随着体系结构的发展
新类型:
1.个人操作系统
2.网络操作系统
3.分布式操作系统
4.嵌入式操作系统
```

```shell
# 一、批处理操作系统
1.基本工作方式
用户将作业交给系统操作员，系统操作员在收到作业后，并不立即将作业输入计算机，而是收到一定数量的用户作业之后，组成一批作业，再把这批作业输入到计算机中。这批作业可在系统中形成一个连续的、自动转接的作业流。系统操作员然后启动操作系统，系统自动、依次执行每个作业。
最后由操作员将执行完毕的作业交给用户。
2.特点与分类
特点:成批处理，用户不能干预自己作业的运行目标:系统资源利用率高，作业吞吐率高。分类:简单批处理和多道批处理
3.设计思想:在监控程序启动之前，操作员有选择地把若干个作业合并成一批作业，将这批作业安装在输入设备上。然后启动监控程序，监控程序将自动控制这批作业的执行。作业的运行与衔接都由监控程序自动控制，从而有效地提高了作业运行的效率。
4.作业控制说明书
作业控制说明书是由作业控制语言编写的一段程序，它通常存储在被处理作业的前面。
作业的运行由作业控制说明书来传递给监控程序，运行过程中，监控程序读入并解释作业说明书，以控制各个作业步的执行。
5.一般指令和特权指令
操作系统的运行模式:用户模式和特权模式处理器的状态:目态和管态机器指令:一般指令和特权指令系统调用:用户程序不能直接使用特权指令，它们必须向操作系统请求这些功能，这些功能通过系统调用完成。
6.系统调用的过程
首先，当系统调用发生时，由中断或异常处理程序，把控制流程转移到监控程序内的一些特定位置，处理器模式变为特权模式。
其次，由监控程序执行被请求的功能。最后，恢复现场，运行模式转变为用户模式，控制权交给用户程序。
7.SPOOLing技术
是多道程序设计的关键技术之一，也称为假脱机技术。

```

```shell
# 二、分时系统
1.基本工作方式
在分时系统中，一台主机连接了若干个终端，每个终端可由一个用户使用。用户通过终端交互式地向系统提出命令请求，系统接收用户命令之后，采用时间片轮转方式处理服务请求，并通过交互方式在终端上向用户显示结果。
2.特点:
多路性
交互性
“独占性”
及时性
```

```shell
# 三、实时操作系统
实时操作系统是指，使计算机能在规定的时间内及时响应外部事件的请求，同时完成对该事件的处理，并能够控制所有实时设备和实时任务协调一致地工作的操作系统。
目标:在严格时间范围内，对外部请求做出反应，系统具有高可靠性。
分类:
硬实时系统和软实时系统
能力:
除了多道程序系统的基本能力外，还有以下功能:
(1)实时时钟管理
(2)过载防护
(3)高可靠性
```

```shell
# 四、嵌入式操作系统
1.定义
在各种电器、电子和智能机械上，嵌入安装着各种微处理器或微控制芯片。
嵌入式操作系统就是运行在嵌入式芯片环境中，对整个芯片以及它所操作、控制的各种部件装置等资源进行统一协调、调度、指挥和控制的系统软件。
```

```shell
# 五、其他操作系统
1.个人计算机操作系统
2.网络操作系统
3.分布式操作系统
```

#### 操作系统设计

```shell
# 一、操作系统的设计过程
1.功能设计
确定所设计的操作系统应具备哪些功能以及操作系统的类型。跟目标有关。
2.算法设计
选择和设计满足系统功能的算法和策略，并分析和估算其效能。
3.结构设计
```

```shell
# 二、操作系统的设计目标
1.可靠性
2.高效性
3.易维护性
4.可移植性
5.安全性
6.简明性
```

```shell
# 三、操作系统的结构设计
操作系统结构研究的目标
1.系统模块化
2.模块标准化
3.通信规范化
```

```shell
# 四、操作系统的结构
常见的操作系统结构
1.整体式结构
2.层次式结构
3.微内核(客户/服务器)结构
```

## 二、操作系统运行环境

#### 处理器

```shell
# 一、处理器的构成与基本工作方式
处理器一般由运算器、控制器和一系列寄存器以
及高速缓存构成。
运算器实现算数与逻辑运算。
控制器控制程序运行流程。
寄存器用于处理器执行指令的过程中暂存数据、地址及指令信息。
高速缓存:为CPU和内存提供一个高速的数据缓存区域。
1.处理器中的寄存器
两类寄存器:
(1)用户可见寄存器，由编译程序分配，减少程序运行时访问内存的次数。一般包括数据寄存器，地址寄存器、条件码寄存器。
(2)控制和状态寄存器，用来控制处理器的操作常见的寄存器是程序计数器(PC)、指令寄存器(IR)、程序状态字(PSW)。
2.指令执行的基本过程
最简单的是两个步骤:
(1)读取指令，并将程序计数器的值变成下一条指令的地址。
(2)指令放入指令寄存器中，处理器解释并执行
该指令。
指令的分类:
访问存储器指令、V/O指令、算数逻辑指令、控制转移指令、控制器控制指令。
```

```shell
# 二、特权指令和非特权指令
在多道程序环境下，指令分为特权指令和非特权指令。1.特权指令:
>在操作系统中那些只能由操作系统使用的指令。
>不允许一般用户使用。
比如:设置程序状态字、启动某设备、设置中断屏蔽字等。
2.非特权指令:
普通用户使用的指令
```

```shell
# 三、处理器的工作状态
2.处理器工作状态的转换
目态到管态的转换:唯一途径是通过中断。中断响应时交换中断向量，新的中断向量的PSW的处理器状态标志位管态。
管态到目态的转换:可通过设置PSW指令，实现从操作系统到用户程序的转换。

1.管态和目态
管态:操作系统管理程序运行时的状态，又称内核态、系统态等，具有较高特权。
目态:一般用户程序运行时的状态，又称用户态、普通态，具有较低特权。
3.限制用户程序执行特权指令
当用户程序执行时，如果取到了一条特权指令，则处理器拒绝执行该指令，并形成一个"非法操作”事件。然后操作系统通知用户程序--程序中有非法指令。
```

```shell
# 四、程序状态字
为了解决处理器当前工作状态的问题，所有的处理器都有一些特殊寄存器，用以表明处理器当前的工作状态。用来指示处理器状态的寄存器，称为程序状态字。比如CF:进位标志、ZF:结果为零标志等。

程序状态字一般包括:
CPU的工作状态代码:指明当前的工作状态是管态还是目态。
条件码:反映指令执行后的结果特征，比如结果
为0等。
>中断屏蔽码:指出是否允许中断
```

#### 计算机系统硬件部件

```shell
# 一、存储系统
1.存储器的类型
(1)类型
读写型存储器(RAM)，用来存储随机存取的程序和数据
只读存储器(ROM)，存放一些固化的程序
(2)存储分块
存储的最小单位:位(bit)最小编制单位:字节分块:为了分配和管理方便，将内存划分为大小相等的块(物理页Page)，以块为单位分配内存空间，大小一般为512B，1KB、4KB、8KB等
2.存储器的层次结构
(1)容量、速度和成本的匹配
寄存器
高速缓存
内存储器
磁盘存储器
远程存储(云存储)
计算机系统中的存储设置
(2)存储访问局部性原理
程序执行时，除了少部分的转移和过程调用指令外，在大多数情况下是顺序执行的。过程调用将会使程序的执行轨迹，由一部分区域转至另一部分区域。即程序将会在一段时间内，都局限在这些过程的范围内运行。
程序中存在许多循环结构，这些虽然只由少数指令构成，但是它们将多次执行。
程序中还包括许多对数据结构的处理，如对数组进行操作，它们往往都局限于很小的范围内。基于这一原理，设计多级存储的体系结构
3.存储器保护
多道程序设计系统中，保证每个程序独立运行、互不干扰，称为存储器保护。
方法:界地址寄存器
```

```shell
# 二、1/0部件
1.I/O结构
2.通道
3.DMA技术
4.缓冲技术
```

```shell
# 三、时钟部件
功能:
(1)发现死循环，防止机时的浪费
(2)分时系统中，时钟间隔实现时间片轮转执行(3)实时系统中，按要求的时间间隔控制设备
(4)定时唤醒各个外部事件
(5)记录各种设备的使用时间和某外部事件发生的时间间隔(6)记录用户和系统所需的绝对时间，即年、月、日
分类:
硬件时钟和软件时钟用途分:绝对时钟和相对时钟
```

#### 中断机制

```shell
# 一、中断与异常的概念
1.中断与异常
中断:指处理器对系统中或系统外发生的异步事件的响应。
异步事件:指无一定时序关系的随机发生的事件，如外部设备完成了数据传输任务，某一实时控制设备出现异常情况等。
中断源:引起中断的事件称为中断事件或中断源。
中断请求:中断源向处理器发出的请求信号。
中断处理程序:处理中断事件的程序
断点:发生中断时正在执行的程序的暂停点。
中断响应:处理器暂停当前程序转而处理中断的过程。
中断返回:中断处理程序结束后恢复原来程序的执行。
中断向量表:为了使得中断装置可以找到恰当的中断处理程序，专门设计了中断处理程序的入口地址映射表，又称中断向量表。
异常:由正在执行的指令引发的中断。
2.中断与异常的分类
典型的中断:时钟中断、输入输出中断、控制台中断、硬件故障中断。
典型的异常:程序性中断，访管指令异常。
```

```shell
# 二、中断系统
1.中断请求的接收
中断系统如何接受中断源的中断请求，因机器而异。
般由中断逻辑线路和中断寄存器实现。
2.中断响应
处理器的控制部件中有中断信号扫描结构，它在每条指令执行周期内的最后时刻扫描中断寄存器，查看是否有中断信号到来。若无中断信号，处理器就继续执行下一条指令。若有中断到来，处理器接收由硬件中断装置发来的中断向量代号，准备中断处理准备工作

中断请求响应过程:
处理器接收中断信号;
保护现场
分析中断向量
将处理器的PC值置为中断程序的入口地址
调用中断处理程序。
3.中断处理
中断信号被接收和响应之后，进行中断处理，包括:检查I/O相关的状态信息，操纵I/O设备或者在设备和内存之间传送数据等。
中断处理结束后，中断返回，恢复系统上下文，原有程序继续运行。处理器状态也从管态恢复成目态。
整个中断信号的接收、响应和处理过程，可归纳
为以下步骤:
(1)接收和响应中断
(2)保护中断断点现场
(3)分析中断向量，调用中断处理程序(4)中断处理结束恢复现场，原有程序继续执行
4.几种典型中断的处理
(1)1/O中断(2)时钟中断(3)硬件故障中断(4)程序性中断(5)系统服务请求
```

```shell
# 三、中断优先级、中断屏蔽与中断嵌套
1.多级中断与中断优先级
作用:
(1)对各类中断信号依据其紧急程度和重要性划分级别，系统优先处理最紧急或最重要的任务。
(2)解决如果有多个中断信号同时到达，如何选择首个被处理的中断信号的问题。
2.中断屏蔽
整个中断系统中，允许或者禁止中断系统对某些类别中断的响应。PSW中设计有中断屏蔽位。
比如:某个I/O被中断屏蔽，意味着即使有I/O中断信号处理器也不予响应。
注意:有些信号是不能被屏蔽的，一般这类中断信号于机器故障中断，比如掉电，机器无法继续操作。一旦发生无论信号是否被屏蔽，处理器都会立即响应，并进行处理。
3.中断嵌套
一般的计算机系统都有多个中断源，如果一个中断处理的过程中又发生了中断，有两种策略处理:
(1)当处理一个中断时禁止其他中断
(2)中断嵌套。即中断按照优先级划分，允许优先级高的中断优先级低的中断处理过程，优先进行处理。如图2-6所示。
```

#### 系统调用

```shell
# 一、系统调用简介
系统调用概念:
就是用户在程序中调用操作系统提供的一些子功能，是操作系统提供给编程人员的唯一接口。
是一种特殊的过程调用，由特殊的机器指令实现，这条指令将系统转入管态。
1.系统调用与函数调用的区别
(1)运行在不同状态
(2)状态的转换
(3)返回问题
(4)嵌套调用
2.系统调用的分类
(1)进程控制类
(2)文件操作类
(3)进程通信类
(4)设备管理类
(5)信息维护类
3.系统调用与库函数、API、内核函数的关系
应用程序
C库函数/API
系统调用
内核
```

```shell
# 二、系统调用的处理过程
陷入(trap):
在系统中为控制系统调用服务的机构称为陷入或异常处理机构。
陷入或异常指令(访管指令):
把由于系统调用引起处理器中断的指令称为陷入或异常指令(或称访管指令)。
处理过程:
图2-8
用户程序
系统调用
陷入处理机制
(1)保护处理器现场
(2)根据系统调用号查找系统调用子程序的入口地址
(3)返回
入口地址表
系统调用子程序
```

## 三、进程与线程





